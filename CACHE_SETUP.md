# Cache Setup Instructions for GitHub + Vercel

## How the Caching System Works

The dashboard uses an **automatic shared cache** system:

1. **First Load**: Shows data from `cache.json` - **INSTANT** for all users
2. **Manual Refresh**: Any user clicks "Refresh" → API processes data → Updates `cache.json` on server
3. **Next User**: Opens site → Sees latest cached data instantly
4. **Data Consumption**: Only when someone clicks refresh, not every page visit

## Benefits
✅ Dashboard loads instantly for all users  
✅ Minimal data consumption  
✅ **Automatic cache updates** - no manual file uploads needed  
✅ Any user's refresh updates cache for everyone  
✅ Works on GitHub + Vercel (serverless)

---

## Setup Instructions for GitHub + Vercel

### 1. Push Code to GitHub
1. Connect your Lovable project to GitHub (click GitHub button in top right)
2. All files will be automatically synced to your repository

### 2. Deploy to Vercel
1. Go to [vercel.com](https://vercel.com) and sign up/login
2. Click "New Project" → Import your GitHub repository
3. Vercel will auto-detect it's a Vite project
4. Click "Deploy" - Done!

### 3. Upload Your Data Files
After deployment, you need to add your data files to the GitHub repo:

**Option A: Via GitHub Web Interface**
1. Go to your GitHub repository
2. Navigate to `public/` folder
3. Upload `customer_master.csv`
4. Create `sales_data/` folder and upload all xlsx files
5. Vercel will auto-redeploy with new files

**Option B: Via Git (if you know Git)**
```bash
git clone your-repo-url
cd your-repo
# Copy your files to public/ and public/sales_data/
git add .
git commit -m "Add data files"
git push
```

### 4. Initialize Cache
1. Visit your deployed site: `https://your-site.vercel.app`
2. Click "Refresh" button
3. API will process data and create `cache.json`
4. Done! Cache is now ready for all users

---

## Project Structure

```
your-project/
├── api/
│   └── update-cache.js   ← Serverless API (auto-deployed)
├── public/
│   ├── cache.json        ← Auto-generated by API
│   ├── config.json       ← Your configuration
│   ├── customer_master.csv
│   └── sales_data/
│       ├── q1.xlsx
│       ├── q2.xlsx
│       ├── current.xlsx
│       └── ...
├── src/                  ← React app
└── vercel.json          ← Vercel configuration
```

---

## How to Update Data

### When you update current.xlsx (daily):
1. **Via GitHub**: Replace `public/sales_data/current.xlsx` in your repo
2. Vercel auto-deploys the update
3. Any user clicks "Refresh" → Cache updates automatically
4. All users see new data on next visit

### When you add new quarter files:
1. Upload new `q8.xlsx` to `public/sales_data/` in GitHub
2. Update `public/config.json` to include `"q8.xlsx"` in salesFiles array:
```json
{
  "salesFiles": [
    "q1.xlsx",
    "q2.xlsx",
    "q3.xlsx",
    "q4.xlsx",
    "q5.xlsx",
    "q6.xlsx",
    "q7.xlsx",
    "q8.xlsx",
    "current.xlsx"
  ]
}
```
3. Vercel auto-deploys
4. Any user clicks "Refresh" → Cache updates with new quarter data

---

## How It Works Internally

1. **User Opens Site**: 
   - Loads `cache.json` (or localStorage) instantly
   - Shows previous cached data

2. **User Clicks Refresh**:
   - Frontend calls `/api/update-cache`
   - API reads all files from `public/` folder
   - Processes customer + sales data
   - Writes updated `cache.json` to `public/` folder
   - Returns fresh data to user
   - User's browser also caches in localStorage

3. **Next User Opens Site**:
   - Loads updated `cache.json` instantly
   - Sees latest data without clicking refresh

## Advantages

✅ **No manual cache updates** - Fully automatic  
✅ **Any user can refresh** for everyone  
✅ **Fast loading** - Instant from cache  
✅ **Low bandwidth** - Only refresh button loads files  
✅ **Serverless** - No server management needed  
✅ **Free hosting** - GitHub + Vercel free tier
