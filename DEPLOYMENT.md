# 🚀 Deployment Guide - GitHub + Vercel

## Quick Start

This project uses **automatic cache updates** via serverless API. When anyone clicks "Refresh", the cache.json file is automatically updated on the server for all users.

---

## Step-by-Step Deployment

### 1. Connect to GitHub

1. In Lovable editor, click **GitHub** button (top right)
2. Authorize Lovable GitHub App
3. Click **"Create Repository"**
4. Your code will be automatically synced to GitHub

### 2. Add Data Files to GitHub

You need to add your data files to the repository:

**Via GitHub Web Interface:**

1. Go to your GitHub repository
2. Navigate to `public/` folder
3. Upload `customer_master.csv`
4. Click "Add file" → "Create new file"
5. Name it: `sales_data/q1.xlsx` (this creates the folder)
6. Upload all your Excel files: `q1.xlsx`, `q2.xlsx`, ..., `current.xlsx`

**Via Git Command Line (if you know Git):**

```bash
# Clone your repository
git clone https://github.com/your-username/your-repo.git
cd your-repo

# Copy your data files
cp /path/to/customer_master.csv public/
cp /path/to/sales_data/*.xlsx public/sales_data/

# Commit and push
git add .
git commit -m "Add data files"
git push
```

### 3. Deploy to Vercel

1. Go to [vercel.com](https://vercel.com)
2. Sign up/login (use GitHub account for easy connection)
3. Click **"New Project"**
4. Click **"Import Git Repository"**
5. Select your GitHub repository
6. Vercel will auto-detect settings:
   - Framework Preset: **Vite**
   - Build Command: `npm run build`
   - Output Directory: `dist`
7. Click **"Deploy"**
8. Wait 1-2 minutes for deployment to complete

### 4. Initialize Cache

1. Visit your deployed site: `https://your-project.vercel.app`
2. You'll see "Click Refresh to load latest data"
3. Click the **"Refresh"** button
4. API will process all data and create `cache.json`
5. Done! 🎉

---

## How It Works

### First User Opens Site:
- Loads `cache.json` instantly (or shows "Click Refresh" if no cache)
- Also checks browser's localStorage for faster load

### Any User Clicks "Refresh":
1. Frontend calls `/api/update-cache` serverless function
2. API reads all files from `public/` folder
3. Processes customer master + all sales files
4. Calculates performance metrics
5. Writes updated `cache.json` to `public/` folder
6. Returns fresh data to user
7. Saves to browser's localStorage

### Next User Opens Site:
- Loads the updated `cache.json` instantly
- Sees latest data without clicking refresh

---

## Updating Data

### Daily Update (current.xlsx):

**Option A: Via GitHub Web**
1. Go to your GitHub repo
2. Navigate to `public/sales_data/current.xlsx`
3. Click "Upload files" and replace it
4. Vercel auto-deploys (takes ~1 minute)
5. Any user clicks "Refresh" → Cache updates

**Option B: Via Git**
```bash
git pull
cp /path/to/new/current.xlsx public/sales_data/
git add public/sales_data/current.xlsx
git commit -m "Update current sales data"
git push
```

### Adding New Quarter Files:

1. Upload `q8.xlsx` to `public/sales_data/` in GitHub
2. Edit `public/config.json`:
```json
{
  "salesFiles": [
    "q1.xlsx",
    "q2.xlsx",
    "q3.xlsx",
    "q4.xlsx",
    "q5.xlsx",
    "q6.xlsx",
    "q7.xlsx",
    "q8.xlsx",
    "current.xlsx"
  ]
}
```
3. Commit and push
4. Vercel auto-deploys
5. Any user clicks "Refresh" → New quarter data included

---

## Project Structure

```
your-project/
├── api/
│   └── update-cache.js      ← Serverless API function
├── public/
│   ├── cache.json           ← Auto-generated by API
│   ├── config.json          ← Your configuration
│   ├── customer_master.csv  ← Your customer data
│   └── sales_data/
│       ├── q1.xlsx
│       ├── q2.xlsx
│       ├── current.xlsx
│       └── ...
├── src/                     ← React application
├── vercel.json              ← Vercel configuration
└── DEPLOYMENT.md            ← This file
```

---

## Configuration (public/config.json)

```json
{
  "customerMasterFile": "/customer_master.csv",
  "salesDataFolder": "/sales_data",
  "salesFiles": [
    "q1.xlsx",
    "q2.xlsx",
    "q3.xlsx",
    "q4.xlsx",
    "q5.xlsx",
    "q6.xlsx",
    "q7.xlsx",
    "current.xlsx"
  ],
  "autoRefreshInterval": 30000
}
```

**Note:** `autoRefreshInterval` is not used in the serverless version. Cache only updates when someone clicks "Refresh".

---

## Troubleshooting

### "Click Refresh to load latest data" message
- This means `cache.json` is empty or doesn't exist
- Click the "Refresh" button to initialize it
- Wait 5-10 seconds for processing

### API Error on Refresh
- Check Vercel deployment logs: `vercel.com` → Your Project → Deployments → View Function Logs
- Ensure all files exist in `public/` folder
- Verify `config.json` has correct file paths

### Data Not Updating
- Refresh button updates cache immediately
- Check browser console (F12) for errors
- Verify files were uploaded to GitHub
- Wait for Vercel auto-deployment to complete (~1-2 min)

### Vercel Build Failed
- Check you have `node-fetch@2`, `papaparse`, and `xlsx` in dependencies
- Lovable automatically manages dependencies
- If issues persist, try redeploying from Vercel dashboard

---

## Performance

- **Initial Load**: < 1 second (from cache)
- **Refresh Time**: 5-15 seconds (depends on file sizes)
- **Vercel Free Tier**: 
  - 100 GB bandwidth/month
  - 100 hours serverless execution/month
  - More than enough for this dashboard

---

## Benefits

✅ **Automatic Cache** - No manual file uploads  
✅ **Instant Loading** - Always shows cached data first  
✅ **Low Bandwidth** - Only refresh button loads full data  
✅ **Serverless** - No server management  
✅ **Free Hosting** - GitHub + Vercel free tier  
✅ **Auto Deploy** - Push to GitHub → Auto deployed  
✅ **Shared Cache** - Any user's refresh updates for everyone

---

## Support

- **Lovable Docs**: https://docs.lovable.dev
- **Vercel Docs**: https://vercel.com/docs
- **GitHub Docs**: https://docs.github.com

For issues, check the browser console (F12) and Vercel function logs.
